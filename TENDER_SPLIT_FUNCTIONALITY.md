# Функционал разделения тендеров

## Описание

Функционал позволяет разделять тендеры на части во время приема предложений. При разделении создается новый тендер с выбранными позициями, а оригинальный тендер остается с оставшимися позициями.

## Основные возможности

### 1. Условия разделения
- Разделять можно только тендеры в статусе "Прием предложений" (BIDDING)
- Разделять можно только позиции, которые принимают предложения
- Новый тендер наследует статус от оригинального тендера

### 2. Процесс разделения
- Выбор позиций для разделения
- Указание количества для отделения в новый тендер
- Настройка описания для новых позиций
- Автоматический пересчет цен пропорционально количеству

### 3. Связь между тендерами
- Новый тендер связан с оригинальным через поле `parent_tender_id`
- Оригинальный тендер остается без изменений в структуре
- Каждый тендер может иметь только одного родителя

## Техническая реализация

### Backend

#### DTO классы
- `TenderSplitRequestDto` - запрос на разделение
- `TenderSplitResponseDto` - ответ с результатом разделения
- `TenderItemSplitDto` - данные о разделении позиции

#### API Endpoint
```
POST /api/tenders/{id}/split
```

#### Параметры запроса
```json
{
  "tenderId": "uuid",
  "itemSplits": [
    {
      "itemId": "uuid",
      "splitQuantity": 10.5,
      "newItemDescription": "Описание новой позиции"
    }
  ]
}
```

#### Ответ
```json
{
  "originalTenderId": "uuid",
  "newTenderId": "uuid",
  "newTenderNumber": "T-123-SPLIT-1234567890",
  "originalItems": [...],
  "newItems": [...],
  "message": "Тендер успешно разделен"
}
```

### Frontend

#### Компонент TenderSplitDialog
- Диалог для выбора позиций и количества
- Валидация введенных данных
- Отображение предварительного расчета цен
- Обработка ошибок и успешного результата

#### Интеграция в TenderDetailPage
- Кнопка "Разделить тендер" в панели управления
- Отображение информации о родительском тендере
- Обновление данных после успешного разделения

## База данных

### Новые поля
- `parent_tender_id` в таблице `tenders` - ссылка на родительский тендер
- Индекс `idx_tenders_parent_tender_id` для быстрого поиска

### Миграция
- `V046_add_parent_tender_id_to_tenders.sql` - добавление поля и индекса

## Бизнес-логика

### Валидация
1. Проверка статуса тендера (только BIDDING)
2. Проверка существования позиций
3. Проверка количества (не превышает доступное)
4. Проверка наличия хотя бы одной позиции для разделения

### Расчеты
1. Пропорциональный пересчет цен по формуле: `новая_цена = старая_цена * (новое_количество / старое_количество)`
2. Обновление количества в оригинальной позиции
3. Создание новых позиций с пересчитанными ценами

### Наследование параметров
Новый тендер наследует от оригинального:
- Заказчика
- Даты начала и окончания
- Срок подачи предложений
- Статус
- Требования и условия
- Связь с заявкой

## Использование

### Для пользователя
1. Открыть детальную страницу тендера в статусе "Прием предложений"
2. Нажать кнопку "Разделить тендер"
3. Выбрать позиции и указать количество для разделения
4. Настроить описания для новых позиций
5. Подтвердить разделение

### Для разработчика
1. Вызвать API endpoint с данными о разделении
2. Обработать ответ с информацией о созданном тендере
3. Обновить UI для отображения изменений

## Ограничения

1. Разделять можно только тендеры в статусе BIDDING
2. Количество для разделения не может превышать доступное
3. Необходимо указать хотя бы одну позицию для разделения
4. Новый тендер наследует статус от оригинального
5. Связь между тендерами только один-к-одному (родитель-потомок)

## Будущие улучшения

1. Возможность разделения на несколько тендеров одновременно
2. Отмена разделения (объединение тендеров)
3. История разделений
4. Уведомления участников о разделении
5. Автоматическое копирование предложений в новый тендер 