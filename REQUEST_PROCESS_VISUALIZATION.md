# Визуализация процесса заявок

## Обзор

Реализована масштабная система визуального отслеживания полной цепочки процесса заявок: **Заявка → Тендер → Предложения → Счет → Поставка**.

## Новые возможности

### 1. Два режима отображения

#### Краткий вид (Brief View)
- Компактное представление всех заявок
- Цветовая кодировка этапов процесса
- Основные финансовые показатели
- Быстрый обзор статуса

#### Подробный вид (Detailed View)
- Полная детализация каждого этапа
- Развернутая информация о поставщиках
- Детализация счетов и поступлений
- Интерактивные элементы для навигации

### 2. Цветовая кодировка

- **Желтый** - Заявки и поставки
- **Голубой** - Тендеры
- **Зеленый** - Предложения
- **Серый** - Контракты
- **Красный** - Счета
- **Белый** - Отсутствующие этапы

### 3. Финансовое отслеживание

- Общая сумма заявки
- Сумма по тендерам
- Дельта (разница между заявкой и тендером)
- Статус оплаты счетов
- Отслеживание поступлений

## Структура данных

### Новые модели

#### Invoice (Счет)
```java
@Entity
@Table(name = "invoices")
public class Invoice {
    private UUID id;
    private Contract contract;
    private Company supplier;
    private Request request;
    private String invoiceNumber;
    private LocalDate invoiceDate;
    private LocalDate paymentDate;
    private InvoiceStatus status;
    private BigDecimal totalAmount;
    private BigDecimal paidAmount;
    private BigDecimal remainingAmount;
    // ... другие поля
}
```

#### Receipt (Поступление)
```java
@Entity
@Table(name = "receipts")
public class Receipt {
    private UUID id;
    private Delivery delivery;
    private Invoice invoice;
    private Company supplier;
    private String receiptNumber;
    private LocalDate receiptDate;
    private ReceiptStatus status;
    private BigDecimal totalAmount;
    // ... другие поля
}
```

### Обновленные модели

#### Request (Заявка)
Добавлены новые поля:
- `approver` - Согласователь
- `performer` - Исполнитель
- `deliveryDeadline` - Срок поставки
- `location` - Местоположение
- `notes` - Примечания
- `status` - Статус заявки (enum)

## API Endpoints

### Получение процесса заявки

#### Краткий вид
```
GET /api/requests/process/brief/{requestId}
GET /api/requests/process/brief/list
```

#### Подробный вид
```
GET /api/requests/process/{requestId}
GET /api/requests/process/list
```

### Структура ответа

```json
{
  "requestId": "uuid",
  "requestNumber": "19 22 25",
  "requestDate": "2025-07-17",
  "organization": "ООО СП Город",
  "project": "Сукко",
  "location": "Сукко / Сукко",
  "applicant": "Полубан А.А.",
  "approver": "Аврутин М.Э.",
  "performer": "Жданов Ю.Я.",
  "deliveryDeadline": "2025-07-28",
  "status": "IN_PROGRESS",
  "requestTotalAmount": 262460.00,
  "tenderTotalAmount": 248166.22,
  "deltaAmount": 14293.78,
  "materialsCount": 12,
  "tendersCount": 1,
  "proposalsCount": 8,
  "contractsCount": 1,
  "invoicesCount": 5,
  "deliveriesCount": 1,
  "receiptsCount": 3,
  "tenders": [...],
  "invoices": [...],
  "deliveries": [...]
}
```

## Компоненты интерфейса

### RequestProcessBrief
Компонент для краткого отображения процесса заявки с:
- Цветовой кодировкой этапов
- Основными финансовыми показателями
- Возможностью развертывания для получения дополнительной информации

### RequestProcessDetailed
Компонент для подробного отображения с:
- Полной детализацией каждого этапа
- Таблицами с данными поставщиков
- Интерактивными элементами навигации
- Детализацией счетов и поступлений

### RequestProcessPage
Главная страница с:
- Переключением между режимами отображения
- Фильтрацией и поиском
- Статистикой
- Адаптивным дизайном

## Навигация

Новая страница доступна по адресу: `/requests/process`

Добавлена в меню: "Тендерные процедуры" → "Процесс заявок"

## Фильтрация и поиск

### Доступные фильтры:
- Организация
- Проект
- Статус заявки
- Период (с даты / по дату)

### Поиск:
- По номеру заявки
- По названию организации
- По проекту
- По местоположению

## Статистика

На странице отображается статистика:
- Общее количество заявок
- Количество завершенных заявок
- Количество заявок в работе
- Количество отмененных заявок

## База данных

### Новые таблицы:
- `invoices` - Счета
- `invoice_items` - Элементы счетов
- `receipts` - Поступления
- `receipt_items` - Элементы поступлений

### Обновления:
- Добавлены новые поля в таблицу `requests`
- Созданы индексы для оптимизации запросов
- Добавлены триггеры для автоматического обновления `updated_at`

## Миграция

Для применения изменений выполните SQL-скрипт:
```sql
-- Файл: src/main/resources/db/migration/V1.1__create_process_tables.sql
```

## Использование

1. Перейдите в меню "Тендерные процедуры" → "Процесс заявок"
2. Выберите режим отображения (краткий/подробный)
3. Используйте фильтры для поиска нужных заявок
4. Кликните на заявку для получения детальной информации
5. Используйте кнопки развертывания для просмотра дополнительных деталей

## Преимущества

1. **Визуальная ясность** - цветовая кодировка позволяет быстро понять статус процесса
2. **Полная трассируемость** - отслеживание всей цепочки от заявки до поставки
3. **Финансовый контроль** - мониторинг бюджетов и отклонений
4. **Удобство использования** - два режима отображения для разных задач
5. **Масштабируемость** - система легко расширяется для новых типов данных 