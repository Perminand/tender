# Условия оплаты и доставки в предложениях

## Обзор

Добавлена новая функциональность для управления условиями оплаты и доставки в предложениях поставщиков. Теперь можно создавать сложные схемы оплаты с несколькими частями и детальные условия доставки.

## Структура базы данных

### Таблицы

#### payment_conditions
- `id` - UUID первичный ключ
- `name` - Название условий оплаты
- `description` - Описание условий
- `created_at`, `updated_at` - Временные метки

#### payment_parts
- `id` - UUID первичный ключ
- `payment_condition_id` - Ссылка на условия оплаты
- `name` - Название части платежа
- `payment_type` - Тип платежа (PERCENTAGE/FIXED_AMOUNT)
- `amount` - Сумма (процент или фиксированная сумма)
- `payment_moment` - Момент оплаты
- `description` - Описание части платежа
- `order_index` - Порядковый номер

#### delivery_conditions
- `id` - UUID первичный ключ
- `name` - Название условий доставки
- `description` - Описание условий
- `delivery_type` - Тип доставки (PICKUP, DELIVERY_TO_WAREHOUSE, etc.)
- `delivery_cost` - Стоимость доставки
- `delivery_address` - Адрес доставки
- `delivery_period` - Срок доставки
- `delivery_responsibility` - Ответственность за доставку
- `additional_terms` - Дополнительные условия

### Связи
- `supplier_proposals.payment_condition_id` -> `payment_conditions.id`
- `supplier_proposals.delivery_condition_id` -> `delivery_conditions.id`

## API Endpoints

### Условия оплаты

#### GET /api/payment-conditions
Получить все условия оплаты

#### GET /api/payment-conditions/{id}
Получить конкретные условия оплаты

#### POST /api/payment-conditions
Создать новые условия оплаты

#### PUT /api/payment-conditions/{id}
Обновить условия оплаты

#### DELETE /api/payment-conditions/{id}
Удалить условия оплаты

#### POST /api/payment-conditions/default
Создать стандартные условия оплаты

### Условия доставки

#### GET /api/delivery-conditions
Получить все условия доставки

#### GET /api/delivery-conditions/{id}
Получить конкретные условия доставки

#### POST /api/delivery-conditions
Создать новые условия доставки

#### PUT /api/delivery-conditions/{id}
Обновить условия доставки

#### DELETE /api/delivery-conditions/{id}
Удалить условия доставки

#### POST /api/delivery-conditions/default
Создать стандартные условия доставки

## Типы платежей

### PaymentType
- `PERCENTAGE` - Процент от общей суммы
- `FIXED_AMOUNT` - Фиксированная сумма в рублях

### PaymentMoment
- `ADVANCE` - Аванс
- `READY_TO_SHIP` - По готовности к отправке
- `UPON_DELIVERY` - По факту поставки
- `AFTER_ACCEPTANCE` - После приемки
- `AFTER_WARRANTY` - После гарантийного срока
- `CUSTOM` - Произвольный момент

## Типы доставки

### DeliveryType
- `PICKUP` - Самовывоз
- `DELIVERY_TO_WAREHOUSE` - Доставка на склад
- `DELIVERY_TO_SITE` - Доставка на объект
- `EX_WORKS` - EXW - Франко завод
- `FCA` - FCA - Франко перевозчик
- `CPT` - CPT - Фрахт оплачен до
- `CIP` - CIP - Фрахт и страхование оплачены до
- `DAP` - DAP - Поставка в месте назначения
- `DPU` - DPU - Поставка в месте назначения разгружено
- `DDP` - DDP - Поставка с оплатой пошлин

### DeliveryResponsibility
- `SUPPLIER` - Поставщик
- `CUSTOMER` - Заказчик
- `SHARED` - Разделенная ответственность

## Стандартные условия

### Условия оплаты
1. **100% аванс** - Полная предоплата
2. **50% аванс, 50% по факту поставки** - Частичная предоплата
3. **50% аванс, 30% по готовности, 20% по факту поставки** - Трехэтапная оплата
4. **По факту поставки** - Оплата после поставки
5. **30 дней после поставки** - Отсрочка платежа
6. **60% аванс, 40% по факту поставки** - Частичная предоплата 60%
7. **70% аванс, 30% по факту поставки** - Частичная предоплата 70%
8. **40% аванс, 30% по готовности, 30% по факту поставки** - Трехэтапная оплата
9. **По факту приемки** - Оплата после приемки
10. **60 дней после поставки** - Отсрочка 60 дней
11. **90 дней после поставки** - Отсрочка 90 дней

### Условия доставки
1. **Самовывоз** - Поставщик не несет ответственности
2. **Доставка на склад поставщика** - Доставка на склад поставщика
3. **Доставка на объект заказчика** - Доставка на объект заказчика
4. **EXW - Франко завод** - Поставка франко завод
5. **FCA - Франко перевозчик** - Поставка франко перевозчик
6. **DAP - Поставка в месте назначения** - Поставка в месте назначения
7. **CPT - Фрахт оплачен до** - Поставка с оплатой фрахта
8. **CIP - Фрахт и страхование оплачены до** - Поставка с оплатой фрахта и страхования
9. **DPU - Поставка в месте назначения разгружено** - Поставка с разгрузкой
10. **DDP - Поставка с оплатой пошлин** - Поставка с оплатой всех пошлин
11. **Доставка на склад заказчика** - Доставка на склад заказчика
12. **Доставка на строительную площадку** - Доставка на строительную площадку

## Фронтенд компоненты

### PaymentConditionForm
Компонент для создания и редактирования условий оплаты с возможностью добавления частей платежа.

### DeliveryConditionForm
Компонент для создания и редактирования условий доставки.

## Примеры использования

### Создание условий оплаты с несколькими частями
```json
{
  "name": "Сложные условия оплаты",
  "description": "Трехэтапная оплата с авансом",
  "paymentParts": [
    {
      "name": "Аванс",
      "paymentType": "PERCENTAGE",
      "amount": 50.0,
      "paymentMoment": "ADVANCE",
      "description": "50% предоплата",
      "orderIndex": 1
    },
    {
      "name": "По готовности",
      "paymentType": "PERCENTAGE",
      "amount": 30.0,
      "paymentMoment": "READY_TO_SHIP",
      "description": "30% по готовности к отправке",
      "orderIndex": 2
    },
    {
      "name": "Остаток",
      "paymentType": "PERCENTAGE",
      "amount": 20.0,
      "paymentMoment": "UPON_DELIVERY",
      "description": "20% по факту поставки",
      "orderIndex": 3
    }
  ]
}
```

### Создание условий доставки
```json
{
  "name": "Доставка на объект",
  "description": "Доставка на строительную площадку",
  "deliveryType": "DELIVERY_TO_SITE",
  "deliveryCost": 15000.0,
  "deliveryAddress": "г. Москва, ул. Строителей, д. 1",
  "deliveryPeriod": "45 дней",
  "deliveryResponsibility": "SUPPLIER",
  "additionalTerms": "Доставка в рабочее время, разгрузка включена"
}
```

## Миграции

### V1.2__create_payment_and_delivery_conditions.sql
Создает основные таблицы и добавляет стандартные условия.

### V1.3__add_payment_delivery_conditions_data.sql
Добавляет дополнительные стандартные условия и создает представления для удобного просмотра.

## Индексы и оптимизация

Созданы индексы для оптимизации запросов:
- `idx_payment_parts_condition_id` - для поиска частей платежа
- `idx_payment_parts_order_index` - для сортировки частей
- `idx_supplier_proposals_payment_condition` - для связи предложений с условиями оплаты
- `idx_supplier_proposals_delivery_condition` - для связи предложений с условиями доставки

## Представления

### payment_conditions_view
Представление для удобного просмотра условий оплаты с частями платежа.

### delivery_conditions_view
Представление для удобного просмотра условий доставки с форматированной стоимостью.

## Логирование

Все операции с условиями оплаты и доставки логируются с использованием SLF4J с уровнем INFO.
