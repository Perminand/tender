#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SSH –∫–ª—é—á–µ–π –¥–ª—è –¥–µ–ø–ª–æ—è

echo "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–µ–π –¥–ª—è –¥–µ–ø–ª–æ—è tender..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
if [ -f ~/.ssh/id_rsa ]; then
    echo "‚ö†Ô∏è  SSH –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ~/.ssh/id_rsa"
    read -p "–•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á? (y/n): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á"
        exit 0
    fi
fi

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π SSH –∫–ª—é—á
echo "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ SSH –∫–ª—é—á–∞..."
ssh-keygen -t rsa -b 4096 -C "tender-deployment@example.com" -f ~/.ssh/tender_deploy_key -N ""

if [ $? -eq 0 ]; then
    echo "‚úÖ SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ"
    echo ""
    echo "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è GitHub Secrets:"
    echo ""
    echo "VDS_SSH_KEY (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á):"
    echo "---"
    cat ~/.ssh/tender_deploy_key
    echo "---"
    echo ""
    echo "–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–¥–æ–±–∞–≤—å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä):"
    echo "---"
    cat ~/.ssh/tender_deploy_key.pub
    echo "---"
    echo ""
    echo "üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
    echo "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ GitHub Secret VDS_SSH_KEY"
    echo "2. –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ VDS —Å–µ—Ä–≤–µ—Ä:"
    echo "   ssh-copy-id -i ~/.ssh/tender_deploy_key.pub root@your-server-ip"
    echo "3. –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤—Ä—É—á–Ω—É—é –≤ ~/.ssh/authorized_keys –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SSH –∫–ª—é—á–∞"
    exit 1
fi 